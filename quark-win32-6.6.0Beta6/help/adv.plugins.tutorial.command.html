<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
  <title>Putting a Command on a Menu</title>
  <meta name="Description" content="QuArK Information Database - Page: 3.6.1.2.&nbsp;Putting a Command on a Menu">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
  <link rel=stylesheet href="standard.css" type="text/css">
</head>

<body>
<a name="__top__"></a>
<table width="100%" border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a target="_blank" href="http://quark.sourceforge.net/"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width="70%" align=center>
      <div class="topheadline">Putting a Command on a Menu</div>
      <div class="sm">Updated&nbsp;25 Jul 2009</div>
    </td>
    <td width="30%" valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="adv.html">3.&nbsp;Advanced&nbsp;customization</a><br>-&nbsp;<a href="adv.plugins.html">3.6.&nbsp;Plug-Ins</a><br>-&nbsp;<a href="adv.plugins.tutorial.html">3.6.1.&nbsp;Plugin&nbsp;Tutorial</a><br>
    </td>
  </tr>
</table>
<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="99%">
      <p class="headline">&nbsp;3.6.1.2.&nbsp;Putting a Command on a Menu</p>
    </td>
    <td width="1%" align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="adv.plugins.tutorial.blather.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="adv.plugins.tutorial.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="adv.plugins.tutorial.tagging.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width="100%" cellspacing=10><tr><td><p>A plugin needs to do four things:
</p><p><OL>
<LI>Get noticed by QuArK
<LI>Import resources from the rest of the program
<LI>Define the actions that the plugin will perform
<LI>Provide menu commands, buttons or some other facility for the user to initiate the actions
</OL>
</p><p>And it should also register itself. So we'll do these five
things in turn.
</p>
</td></tr></table>
<br>

<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="100%">
      <p class="subheadline">&nbsp;Index</p>
    </td>
  </tr>
</table>
<ul class="index">
  <li>- <a href="#starting">Setting up</a>&nbsp;<span class="added">(02 Mar 2001)</span>
  <li>- <a href="#import">Importing</a>&nbsp;<span class="added">(29 Oct 2000)</span>
  <li>- <a href="#action">Action</a>&nbsp;<span class="added">(25 Jul 2009)</span>
  <li>- <a href="#menu">Putting it on a menu</a>&nbsp;<span class="added">(05 Jul 2003)</span>
  <li>- <a href="#register">Registering</a>&nbsp;<span class="added">(02 Mar 2001)</span>
</ul>
<br>


<a name="starting"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Setting up</p>
      </td>
      <td align=right>
        <font size=-2>tiglari&nbsp;-&nbsp;02 Mar 2001</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>What we'll be doing is making a replacement maptagside plugin.
The real one is interconnected with some other plugins
which we'll have to disable, &amp; it would not be a good
idea to mess with your regular QuArK installation, so
you should make a second one, and in that installation,
remove the files `plugins\mb2caulk' and `plugins\maptagside'.
</p><p>Since we're going to be making a series of new maptagside
plugins, it might be convenient to call them maptagside0.py,
maptagside01.py; you can disable the older ones and keep
them from loading by renaming them `tagside0.py', etc
(since plugins are only loaded by the mapeditor if their
names begin with q- or map-, or mb2- for Q3 engine games).
</p>
  </td></tr></table>
  <br>

<a name="import"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Importing</p>
      </td>
      <td align=right>
        <font size=-2>tiglari&nbsp;-&nbsp;29 Oct 2000</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>What you need to import depends on what you're doing; what we'll
need for the whole plugin is this:
<div class="doccode"><pre>
import quarkx
import quarkpy.mapmenus
import quarkpy.mapentities
import quarkpy.qmenu
import quarkpy.mapeditor
import quarkpy.mapcommands
from quarkpy.maputils import *
</pre></div>
We will gradually explain what all this means.
</p>
  </td></tr></table>
  <br>

<a name="action"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Action</p>
      </td>
      <td align=right>
        <font size=-2>tiglari&nbsp;-&nbsp;25 Jul 2009</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>To produce the action we want, we need this:
<div class="doccode"><pre>
def tagSideClick(m):
    quarkx.msgbox(&quot;This command does nothing&quot;, MT_INFORMATION, MB_OK)
</pre></div>
</p><p>This defines a function `tagSideClick', which gets a parameter `m', which is the actual menu item that invoked the action.  We don't use this
here, but we will later on.
The body of the function calls the `msgbox' function from the module
`quarkx', which is imported in the first import statement.  Note
that this works a bit differently from say an
&nbsp;<tt>#include</tt>&nbsp;
in C; when we import a module, we can't just use the names of the
functions in it, but have to `qualify' those names by putting the
module name in front, separated by a period.
</p><p>This is to improve readability, at the expense of a a bit of
typing on the part of the writer of the program; the name of
the important function when it's used states where it came from,
so the reader has a better chance of finding out what it does.
We will soon see how to use unqualified imported names as well.
</p><p>As for the actual &nbsp;<tt>msgbox</tt>&nbsp; function, it produces little
`message box' dialogs that you can respond to by pushing buttons; its
first argument is the string to be displayed in the
message box, the second a `type' which determines the graphic icons
associated with the box, and third a flag that says that
the messagebox has an OK button.
</p><p>Symbolic names for the useful values for these arguments are
defined in the file &nbsp;<tt>quarkpy\qtils.py</tt>&nbsp;,
under the heading `# quarkx.msgbox'.
So you can look there to see what the possibilities are.
But hey, we haven't imported this module, and the symbols
aren't qualified anyway, so what's going on?
</p><p>What we have done is imported the module quarkpy.maputils,
in a somewhat different way, in the last line of the import
statement. &nbsp;<tt>from <i>&lt;module name%gt;</i>&nbsp; import *</tt>&nbsp;
means `import everything that's defined in the named module, and use it without
qualification'.  And furthermore, &nbsp;<tt>quarkpy.maputils,</tt>&nbsp;
a general grab-bag of utility functions for the map editor, imports
&nbsp;<tt>quarkpy.qeditor</tt>&nbsp; in this way, which itself does the same to
&nbsp;<tt>quarkpy.qutils.py</tt>&nbsp;. So everything defined
in all of these modules is available to our plugin, without
qualifying the names.
</p><p>This is convenient for the writer, but can be confusing
for the reader.  Even more so because symbols defined in later
imports will override definitions from earlier ones.  So this
import style should only be used for a limited number of
widely used utility files, which people working on the program
can be expected to learn about soon.
</p><p>One more thing with the import statements, what's the deal
with the dots?  Python modules are religiously identified
as files, and folders are taken to be `super modules' containing
sub-modules.  So all of the files in quarkpy make up the quarkpy
module, and to import them into a file outside of quarkpy
you need the quarkpy. qualification.  Inside quarkpy you don't,
so the statement that &nbsp;<tt>maputils.py</tt>&nbsp; uses to import &nbsp;<tt>qeditor.py</tt>&nbsp; is just:
<div class="doccode"><pre>
from qeditor import *
</pre></div>
</p>
  </td></tr></table>
  <br>

<a name="menu"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Putting it on a menu</p>
      </td>
      <td align=right>
        <font size=-2>tiglari&nbsp;-&nbsp;05 Jul 2003</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>So now that we've got some code that does something,
we need to install a menu item so the user can have it done:
<div class="doccode"><pre>
quarkpy.mapcommands.items.append(qmenu.item(&quot;&amp;Do Nothing&quot;, TagSideClick))
</pre></div>
On important point is that the text of this line has to start at
the same horizontal position as the `def' line above, so that
the whole thing looks like this:
<div class="doccode"><pre>
def tagSideClick (m):
    quarkx.msgbox(&quot;This command does nothing&quot;, MT_INFORMATION, MB_OK)
</pre></div>
<div class="doccode"><pre>
quarkpy.mapcommands.items.append(quarkpy.qmenu.item(&quot;&amp;Do Nothing&quot;, tagSideClick))
</pre></div>
rather than say like this:
<div class="doccode"><pre>
def tagSideClick (m):
    quarkx.msgbox(&quot;This command does nothing&quot;, MT_INFORMATION, MB_OK)
</pre></div>
<div class="doccode"><pre>
    quarkpy.mapcommands.items.append(qmenu.item(&quot;&amp;Do Nothing&quot;, tagSideClick))
</pre></div>
The reason is that Python uses indendation to impose block-structure,
so that the first version first defines the TagSideClick function
and then puts an item on the mapcommands menu, while the second
version defines a TagSideClick function that first produces a
message-box and then adds something to the menu (so that something
will never show up unless the TagSideClick function gets called,
which isn't going to happen).
The blank line on other hand is just make the presentation clearer,
and doesn't affect the operation of the program.
</p><p>And it remains to explain what this menu-item-adding line actually
does.  quarky.mapcommands is the module where the `commands'
menu is defined.  It creates a list-valued variable `items',
and `append' is a built-in Python function for attaching
something to a list.
</p><p>What we append to this list is an something created by the
`item' function, defined in the module quarkpy.qmenu.  We don't
have to import this module because that job is already done by
the qeditor.py module.  This has among its import statements:
<div class="doccode"><pre>
import qmenu
</pre></div>
So when we import everything from quarkpy.maputils, and it
imports everything from quarkpy.qeditor, we wind up getting
qmenu, but we have to qualify the stuff in it with `qmenu'.
This lets us use obvious words like `item', without having
to use clumsy prefixing conventions, etc. to prevent name
collisions.
</p><p>So when this is all typed out and saved into a file `maptagside.py' in
in the plugins directory, you should be able to start up QuArK, fire
up the map editor, find the `Do Nothing' command on the command menu,
click on it, and see the resulting message box.
</p><p>If it doesn't work, possible explanations are:
<UL>
<LI> A syntax error in the program, in which case you'll be looking
at the QuArK console, which will have some kind of error message.
<LI> Your module-file's name doesn't start with `map', in which case
QuArK will work but your new command won't appear on the menu.
<LI> Something else, tell me when you manage to figure out it.
</UL>
</p><p>If all else fails, the file &nbsp;<tt>maptagside0.py</tt>&nbsp; in
<a href="zips">plugin_examples.zip</a>
contains what is hopefully a working version of the code for this
section.
</p><p>I'll also say a bit more about what goes on when modules are loaded.
When a module is loaded, it is first `compiled' into a file with the
same name and extension .pyc, which will load more quickly.  If
the current .py file is older than the corresponding .pyc file,
the compilation stage is skipped, and the .pyc file is loaded
straight in.  So you can delete all the .pyc files if you want to,
but it will slow things down the first time QuArK is run.
</p>
  </td></tr></table>
  <br>

<a name="register"></a>
  <table width="100%" border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Registering</p>
      </td>
      <td align=right>
        <font size=-2>tiglari&nbsp;-&nbsp;02 Mar 2001</font>
      </td>
      <td width="1%" align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width="100%" cellspacing=10><tr><td>
<p>Finally, a properly dressed plugin should announce itself
to QuArK, so it will be listed under Options|List of Plugins.
This is done by including an Info statement, normally at
the beginning of the file:
<div class="doccode"><pre>
Info = {
   &quot;plug-in&quot;:       &quot;Side Tag &amp; Glue&quot;,
   &quot;desc&quot;:          &quot;Basic Side tagging and gluing to tagged side&quot;,
   &quot;date&quot;:          &quot;1999&quot;,
   &quot;author&quot;:        &quot;tiglari&quot;,
   &quot;author e-mail&quot;: &quot;tiglari@hexenworld.net&quot;,
   &quot;quark&quot;:         &quot;Version 6&quot; }
</pre></div>
</p><p>So now we've got a proper plugin; next is to get it to
do something useful.
</p>
  </td></tr></table>
  <br>

<br>

<table width="100%" border=0 cellspacing=0>
  <tr class="headline">
    <td width="99%" align=center>
      <p class="sm">
        Copyright (c) 2009, GNU General Public License by The QuArK (Quake Army Knife) Community - <a target="_blank" href="http://quark.sourceforge.net/">http://quark.sourceforge.net/</a><br>
      </p>
    </td>
    <td width="1%" align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="adv.plugins.tutorial.blather.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="adv.plugins.tutorial.tagging.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>